<!DOCTYPE html>
<html>
<head>
  <title>Titanic Data Visualization</title>
  <meta charset="utf-8">
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://dimplejs.org/dist/dimple.v2.0.0.min.js"></script>
  <style type="text/css">
      h2 {
        text-align: center;
        font-family: Verdana;
      }
      h6 {
        text-align: left;
        font-family: Tahoma;
      }
      body {
        width: 80%;
        margin-right: auto;
        margin-left: auto;
      }
      div.stat_buttons {
            position: fixed;
            top: 300px;
            left: 1300px;
        }
      div.stat_buttons div {
            background-color: rgb(244, 93, 120);
            padding: 3px;
            margin: 7px;
            cursor: pointer;
            border: 2px solid rgb(80, 183, 101);
            font-family: Georgia;
        }
  </style>
  <script type="text/javascript">
      function draw(data) {

        //Define the canvas size for the visualization
        "use strict";
        var margin = 75,
            width = 1400 - margin,
            height = 600 - margin;

        //Add title for the visualization with a summary statement
        d3.select("body")
          .append("h2")
          .text("Survival Rates in the Titanic Disaster")
          .append("h6")
          .text("The sinking of the RMS Titanic in April 1912 is considered the deadliest peacetime maritime disasters in history. From the estimated 2,224 passengers onboard, more than 1,500 died when the RMS Titanic struck an iceberg and sank in the North Atlantic Ocean. The data file contains information of a sample of 891 passengers such as Passenger Class (socio-economic status), Sex, Age and Number of Sibling/Spouse/Parent/Children travelling with them. The purpose of the visualization is primarily explanatory, which aims at displaying the statistics of people who died and survived based on their socio-economic status (First, Second or Third class) and their gender (Male or Female). As can be seen, most female passengers from upper class tickets survived whilst a large loss of life came from male passengers in the third class.");

        var svg = dimple.newSvg("body", width + margin, height + margin);

        //Define chart type (y-axis type) for the initial visualization
        var chartType = "Percentage";

        //Define update function to call when the button is pressed to change y-axis scale
        function chartUpdate(chartType) {

            //Define chart boundary
            var myChart = new dimple.chart(svg, data);
            myChart.width = "70%";
            myChart.height = "70%";

            //Define x-axis variable, title and bar-chart order
            var x = myChart.addCategoryAxis("x", "GenderClass");
            x.addOrderRule("GenderClass");
            x.title = "Passenger Class and Gender - (Hover on bars to see details)";

            //Define y-axis scales and title that update when chart is updated by clicking the button
            if(chartType == "Count") {
            var y = myChart.addMeasureAxis("y", "Count");
            y.title = "Number of Passengers (Click button to change)";
            } else if(chartType == "Percentage") {
            var y = myChart.addPctAxis("y", "Count");
            y.title = "Percentage of Passengers (Click button to change)";
            }

            //Define stacked bar chart split using survival status
            var mySeries = myChart.addSeries(["Status"], dimple.plot.bar);
            //Use aggregate function to calculate sum and percentage
            mySeries.aggregate = dimple.aggregateMethod.count;

            //Define legend position and color scheme for bars
            myChart.addLegend(1130, 250, 100, 100, "right");
            myChart.assignColor("Casualty", "rgb(244, 93, 120)");
            myChart.assignColor("Survivor", "rgb(80, 183, 101)");
            //Draw chart
            myChart.draw(500);
        }

        //Call chart update function for the first plot using "Percentage"
        chartUpdate(chartType);

        //Define y-axis scale options for buttons
        var stat = ["Percentage", "Count"]

        //Define buttons
        var buttons = d3.select("body")
                        .append("div")
                        .attr("class", "stat_buttons")
                        .selectAll("div")
                        .data(stat)
                        .enter()
                        .append("div")
                        .text(function(d) {
                          return d;
                        });

        //Define button click behavior and chart update sequence by first removing the previous plot and then updating with the new plot
        buttons.on("click", function(d) {
            d3.select(".stat_buttons")
              .selectAll("div")
              .transition()
              .duration(500)
              .style("color", "black")
              .style("background", "rgb(239, 215, 221)");

            d3.select(this)
              .transition()
              .duration(500)
              .style("background", "rgb(205, 242, 211)")
              .style("color", "white");
            svg.selectAll("*").remove();
            chartUpdate(d);
        })

      }
  </script>
</head>
<body>
  <script type="text/javascript">
      //Load data and call draw function
      d3.csv("titanic_data.csv", draw);
  </script>
</body>
</html>
